<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"/>
  <title>Mládežnícky spevník NIŽNÁ</title>

  <link rel="manifest" href="manifest.json?v=39">
  <meta name="theme-color" content="#00bfff">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Spevník">
  <link rel="apple-touch-icon" href="icon.png?v=39">
  <link rel="icon" type="image/png" href="icon.png?v=39">

  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" crossorigin="anonymous"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="style.css?v=39"/>
</head>

<body>

<div id="toast" class="toast" style="display:none;"></div>

<div class="container">

  <button id="scroll-to-top" onclick="stopAutoscroll(); window.scrollTo({top: 0, behavior: 'smooth'})">
    <i class="fas fa-arrow-up"></i>
  </button>

  <!-- HEADER -->
  <div class="topbar">
    <button id="admin-toggle-btn" onclick="toggleAdminAuth()">
      <i class="fas fa-user"></i>
      <span id="admin-toggle-text">PRIHLÁSIŤ</span>
    </button>

    <h1 class="main-title">Mládežnícky spevník NIŽNÁ</h1>

    <i class="fas fa-home home-ico" onclick="goHomeUI()"></i>
  </div>

  <!-- LIST VIEW -->
  <div id="song-list">
    <input type="text" id="search" placeholder="Hľadať pieseň alebo číslo..." autocomplete="off" oninput="filterSongs()"/>

    <!-- DNES -->
    <div class="section-header" onclick="toggleSection('dnes')">
      <h2 class="playlist-header-title" id="dnes-title">PIESNE NA DNES</h2>
      <i class="fas fa-chevron-down section-chevron" id="dnes-chevron"></i>
    </div>
    <div id="dnes-section-wrapper" class="section-content" style="display:none;">
      <div id="dnes-section" class="list-box"><div class="loading">Načítavam...</div>
</div>

      <div id="dnes-editor-panel" class="editor-panel" style="display:none;">
        <div class="editor-toggle" onclick="toggleEditor('dnes-editor-panel')">
          <div class="editor-toggle-title">Editor – Piesne na dnes</div>
          <i class="fas fa-chevron-down editor-toggle-ico"></i>
        </div>
        <div class="editor-body">
          <h3 class="editor-title">Editor – Piesne na dnes</h3>
        <input type="text" id="dnes-name" placeholder="Názov zoznamu (napr. Piatok 16.1.)" maxlength="40"/>

        <div class="editor-subtitle">Piesne v zozname (ťahaj pre poradie)</div>
        <div id="dnes-selected-editor" class="editor-list"></div>

        <input type="text" id="dnes-search" placeholder="Vyhľadať pieseň..." autocomplete="off" oninput="filterDnesSearch()"/>
        <div class="editor-subtitle">Všetky piesne (klikni pre pridanie)</div>
        <div id="dnes-available-list" class="editor-list"></div>
<div class="btn-row-2">
          <button id="dnes-save-btn" id="dnes-save-btn" class="btn-save" onclick="saveDnesEditor()">ULOŽIŤ</button>
          <button class="btn-neutral" onclick="saveDnesToHistory()">ULOŽIŤ DO HISTÓRIE</button>
          <button class="btn-delete" onclick="clearDnesSelection()">VYMAZAŤ</button>
        </div>
        </div>
      </div>
    </div>

    <!-- PLAYLISTY -->
    <div class="section-header" onclick="toggleSection('playlists')">
      <h2 class="playlist-header-title">PLAYLISTY</h2>
      <i class="fas fa-chevron-down section-chevron" id="playlists-chevron"></i>
    </div>
    <div id="playlists-section-wrapper" class="section-content" style="display:none;">
      <div id="playlists-section" class="list-box"><div class="loading">Načítavam...</div></div>

      <div id="admin-panel" class="editor-panel" style="display:none;">
        <div class="editor-toggle" onclick="toggleEditor('admin-panel')">
          <div class="editor-toggle-title">Editor playlistov</div>
          <i class="fas fa-chevron-down editor-toggle-ico"></i>
        </div>
        <div class="editor-body">
          <h3 class="editor-title">Editor playlistu</h3>
        <input type="text" id="playlist-name" placeholder="Názov playlistu"/>

        <div class="editor-subtitle">Piesne v playliste (ťahaj pre poradie)</div>
        <div id="selected-list-editor" class="editor-list"></div>

        <input type="text" id="playlist-search" placeholder="Vyhľadať pieseň..." autocomplete="off" oninput="filterPlaylistSearch()"/>
        <div class="editor-subtitle">Všetky piesne (klikni pre pridanie)</div>
        <div id="playlist-available-list" class="editor-list"></div>
<div class="btn-row-2">
          <button id="playlist-save-btn" class="btn-save" onclick="savePlaylist()">ULOŽIŤ</button>
          <button class="btn-neutral" onclick="newPlaylist()">NOVÝ PLAYLIST</button>
          <button class="btn-delete" onclick="clearSelection()">VYMAZAŤ</button>
        </div>
        </div>
      </div>
    </div>

    <!-- ALL -->
    <div class="section-header" onclick="toggleSection('all')">
      <h2 class="playlist-header-title">ZOZNAM PIESNÍ</h2>
      <i class="fas fa-chevron-down section-chevron" id="all-chevron"></i>
    </div>
    <div id="all-section-wrapper" class="section-content" style="display:none;">
      <div id="piesne-list" class="list-box"><div class="loading">Načítavam...</div></div>
  </div>

    

    <!-- LITURGICAL CALENDAR -->
    <div class="section-header" onclick="toggleSection('lit')">
      <h2 class="playlist-header-title">LITURGICKÝ KALENDÁR</h2>
      <i class="fas fa-chevron-down section-chevron" id="lit-chevron"></i>
    </div>
    <div id="lit-section-wrapper" class="section-content" style="display:none;">
      <div class="lit-card">
        <div class="lit-header">
          <div id="lit-head-left" class="lit-head-left">—</div>
          <div id="lit-head-right" class="lit-head-right"></div>
        </div>

        <div class="lit-picker">
          <div class="date-btn-wrap">
            <button id="lit-date-btn" class="btn-neutral" type="button"><i class="fas fa-calendar"></i> Vybrať deň</button>
            <!-- Na PC niektoré prehliadače blokujú programmatic click() na date input.
                 Preto je input položený priamo na tlačidle (opacity 0), aby klik otvoril picker. -->
            <input id="lit-date-input" class="date-overlay" type="date" aria-label="Vybrať deň">
          </div>
        </div>

        <div id="lit-variant-row" class="lit-variant-row" style="display:none;">
          <span class="tiny-label">Možnosť:</span>
          <select id="lit-variant-select"></select>
        </div>

        <div id="lit-status" class="lit-status loading">Načítavam...</div>
        <div id="lit-content" class="lit-content"></div>
      </div>
    </div>

<!-- HISTORY (public) -->
    <div class="section-header" onclick="toggleSection('history')">
      <h2 class="playlist-header-title">HISTÓRIA</h2>
      <i id="history-chevron" class="fas fa-chevron-down section-chevron"></i>
    </div>
    <div id="history-section-wrapper" class="section-content" style="display:none;">
      <div class="list-box" style="padding:10px 12px;">
        <input id="history-search" class="search" type="text" placeholder="Hľadať v histórii..." oninput="filterHistorySearch()" />
      </div>
      <div id="history-section" class="list-box"></div>
    </div>
  </div>

  <!-- SONG DETAIL -->
  <div id="song-detail" style="display:none;">
    <h2 id="render-title"></h2>
    <button class="back-btn" onclick="closeSong()"><i class="fas fa-arrow-left"></i> Späť na zoznam</button>

    <div class="controls">
      <div class="control-group">
        <small>Pieseň</small>
        <div class="btn-row">
          <button onclick="navigateSong(-1)"><i class="fas fa-chevron-left"></i></button>
          <button onclick="navigateSong(1)"><i class="fas fa-chevron-right"></i></button>
        </div>
      </div>

      <div class="control-group">
        <small>Tónina: <span id="transpose-val">0</span></small>
        <div class="btn-row">
          <button onclick="transposeSong(-1)"><i class="fas fa-minus"></i></button>
          <button onclick="resetTranspose()"><i class="fas fa-undo"></i></button>
          <button onclick="transposeSong(1)"><i class="fas fa-plus"></i></button>
        </div>
        <span id="original-key-label" class="tiny-label">-</span>
      </div>

      <div class="control-group">
        <small>Text: <span id="font-size-label">17</span>px</small>
        <div class="btn-row">
          <button onclick="toggleChords()"><i class="fas fa-guitar"></i></button>
          <button onclick="changeFontSize(-1)">A-</button>
          <button onclick="changeFontSize(1)">A+</button>
        </div>
      </div>

      <div class="control-group">
        <small>Doplnenie akordov</small>
        <div class="btn-row">
          <button id="tmpl-btn" onclick="toggleChordTemplate()"><i class="fas fa-stream"></i></button>
        </div>
        <span id="tmpl-label" class="tiny-label">ON</span>
      
</div>


      <div class="control-group" id="dnes-view-group" style="display:none">
        <small>Zobrazenie</small>
        <div class="btn-row">
          <button id="dnes-view-btn" onclick="toggleDnesView()" title="Zobraziť originál"><i class="fas fa-undo"></i></button>
        </div>
        <span id="dnes-view-label" class="tiny-label">DNES</span>
      </div>



      <div class="control-group">
        <small>Auto-posun</small>
        <div class="btn-row">
          <button onclick="changeScrollSpeed(-1)"><i class="fas fa-minus"></i></button>
          <button id="scroll-btn" onclick="toggleAutoscroll()"><i class="fas fa-play"></i></button>
          <button onclick="changeScrollSpeed(1)"><i class="fas fa-plus"></i></button>
        </div>
        <span id="speed-label" class="tiny-label">Rýchlosť: 1</span>
      </div>

      <div class="control-group">
        <small>Prezentácia</small>
        <div class="btn-row">
          <button id="present-btn" onclick="togglePresentationMode()"><i class="fas fa-tv"></i></button>
        </div>
        <span class="tiny-label">Režim</span>
      </div>
    </div>

    <div id="aleluja-lit-controls" style="display:none;"></div>

    <div id="song-content"></div>

    <!-- ERROR REPORT -->
    <div id="error-report-container">
      <p class="error-title">Našiel/la si chybu? Napíš, opravím :)</p>

      <form id="error-form" onsubmit="submitErrorForm(event)">
        <input type="hidden" name="_subject" id="error-subject" value="Chyba v piesni">
        <input type="hidden" name="piesen" id="error-song-hidden" value="">
        <input type="text" name="meno" placeholder="Tvoje meno" required>
        <textarea name="chyba" placeholder="Napr. chybný akord, preklep v texte..." required></textarea>
        <button type="submit" id="submit-btn">ODOSLAŤ</button>
      </form>

      <p id="form-status" style="display:none;">Chyba bola odoslaná!</p>
    </div>

  </div>
</div>

<!-- ✅ FLOATING GEAR BUTTON (LEFT) -->
<div id="fab-update">
  <button id="fab-btn" onclick="toggleFabMenu(event)" aria-label="Nastavenia">
    <i class="fas fa-gear"></i>
  </button>

  <button id="fab-newdata-btn" onclick="runUpdateNow()" aria-label="Nová aktualizácia" style="display:none;">
    <i class="fas fa-arrows-rotate"></i>
  </button>

  <div id="fab-menu" class="fab-menu" aria-hidden="true">
    <button id="fab-update-btn" onclick="hardResetApp()">Aktualizovať aplikáciu</button>
    <button id="fab-diag-btn" onclick="openDiagnostics()">Diagnostika</button>
  </div>
</div>

<!-- PREZENTAČNÝ REŽIM: OVERLAY OVLÁDANIE -->
<div id="presentControls" aria-hidden="true">
  <button id="psSlower" onclick="presentSlower()" aria-label="Pomalšie"><i class="fas fa-minus"></i></button>
  <button id="psPlayPause" onclick="presentPlayPause()" aria-label="Play/Pause"><i class="fas fa-play"></i></button>
  <button id="psFaster" onclick="presentFaster()" aria-label="Rýchlejšie"><i class="fas fa-plus"></i></button>
  <span id="psSpeed" class="psSpeed">Rýchlosť: 1</span>
  <button id="psExit" onclick="exitPresentationMode()" aria-label="Ukončiť"><i class="fas fa-xmark"></i></button>
</div>

<script src="script.js?v=41"></script>

  <!-- FORM EDITOR MODAL -->
  <div id="form-modal" class="modal-overlay" style="display:none;">
    <div class="modal-sheet" role="dialog" aria-modal="true" aria-labelledby="form-modal-title">
      <div class="modal-header">
        <button class="modal-close" onclick="closeFormModal()"><i class="fas fa-times"></i></button>
        <div id="form-modal-title" class="modal-title">Forma piesne</div>
        <button id="form-modal-save" class="modal-save" onclick="saveFormModal()">Uložiť</button>
      </div>

      <div class="modal-body">
        <div class="modal-block">
          <div class="modal-label">Náhľad označení v texte</div>
          <div id="form-preview" class="form-preview"></div>
        </div>

        <div class="modal-block">
          <div class="modal-label">Poradie</div>
          <div id="form-order" class="form-order"></div>
          <div class="modal-hint">Klikni na bežnú položku v poradí pre odstránenie. Špeciálne (Predohra/Medzihra/Dohra/Poznámka) klikom upravíš.</div>
        </div>

        <div class="modal-block">
          <div class="modal-label">História piesne</div>
          <div id="form-history" class="form-history"></div>
          <div class="modal-hint">Klikni na záznam a nastaví sa poradie tak, ako bolo v histórii.</div>
        </div>

        <div class="modal-block">
          <div class="modal-label">Pridať časť</div>
          <div id="form-buttons" class="form-buttons"></div>
        </div>

        <div class="modal-block">
          <div class="modal-label">Špeciálne</div>
          <div class="form-buttons">
            <button class="chip-btn" onclick="addSpecialStep('PREDOHRA')">Predohra</button>
            <button class="chip-btn" onclick="addSpecialStep('MEDZIHRA')">Medzihra</button>
            <button class="chip-btn" onclick="addSpecialStep('DOHRA')">Dohra</button>
            <button class="chip-btn" onclick="addSpecialStep('POZNAMKA')">Poznámka</button>
          </div>
          <div class="modal-hint">Poznámku dopíšeš po kliknutí (napr. akordy, pokyn).</div>
        </div>
      </div>
    </div>
  </div>

  <!-- DIAGNOSTIKA -->
  <div id="diag-modal" class="modal-overlay" style="display:none;">
    <div class="modal-sheet" role="dialog" aria-modal="true" aria-labelledby="diag-modal-title">
      <div class="modal-header">
        <button class="modal-close" onclick="closeDiagnostics()"><i class="fas fa-times"></i></button>
        <div id="diag-modal-title" class="modal-title">Diagnostika</div>
        <button class="modal-save" onclick="copyDiagnostics()">Kopírovať</button>
      </div>
      <div class="modal-body">
        <div class="modal-block">
          <div class="modal-label">Stav</div>
          <div id="diag-summary" class="diag-summary"></div>
        </div>

        <div class="modal-block">
          <div class="modal-label">Detaily</div>
          <textarea id="diag-text" class="diag-text" readonly></textarea>
          <div class="modal-hint">Skopíruj a pošli, ak niečo nejde.</div>
          <div class="form-buttons" style="margin-top:10px; justify-content:flex-end;">
</div>
        </div>
      </div>
    </div>
  </div>

</body>
</html>