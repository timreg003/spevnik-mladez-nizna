<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"/>
  <title>Mládežnícky spevník NIŽNÁ</title>

  <link rel="manifest" href="manifest.json?v=5">
  <meta name="theme-color" content="#00bfff">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Spevník">
  <link rel="apple-touch-icon" href="icon.png?v=5">

  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" crossorigin="anonymous"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="style.css?v=5"/>

  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js').catch(err => console.log(err));
      });
    }
  </script>
</head>

<body>
<div class="container">

  <button id="scroll-to-top" onclick="stopAutoscroll(); window.scrollTo({top: 0, behavior: 'smooth'})">
    <i class="fas fa-arrow-up"></i>
  </button>

  <!-- HEADER -->
  <div class="topbar">
    <button id="admin-toggle-btn" onclick="toggleAdminAuth()">
      <i class="fas fa-user"></i>
      <span id="admin-toggle-text">PRIHLÁSIŤ</span>
    </button>

    <h1 class="main-title">Mládežnícky spevník NIŽNÁ</h1>

    <i class="fas fa-home home-ico" onclick="smartReset()"></i>
  </div>

  <!-- LIST VIEW -->
  <div id="song-list">

    <input type="text" id="search" placeholder="Hľadať pieseň alebo číslo..." autocomplete="off" oninput="filterSongs()"/>

    <!-- ===== PIESNE NA DNES ===== -->
    <div class="section-header" onclick="toggleSection('dnes')">
      <h2 class="playlist-header-title" id="dnes-title">PIESNE NA DNES</h2>
      <i class="fas fa-chevron-down section-chevron" id="dnes-chevron"></i>
    </div>

    <div id="dnes-section-wrapper" class="section-content" style="display:none;">
      <div id="dnes-section" class="list-box">Načítavam...</div>

      <!-- EDITOR DNES – pod vloženými piesňami -->
      <div id="dnes-editor-panel" class="editor-panel" style="display:none;">
        <h3 class="editor-title">Editor – Piesne na dnes</h3>

        <!-- 1) názov zoznamu / súboru (mení veľký nadpis) -->
        <input type="text" id="dnes-name" placeholder="Názov zoznamu (napr. Piatok 16.1.)" maxlength="40"/>

        <!-- 2) filter -->
        <input type="text" id="dnes-search" placeholder="Vyhľadať pieseň..." autocomplete="off" oninput="filterDnesSearch()"/>

        <!-- 3) všetky piesne -->
        <div class="editor-subtitle">Všetky piesne (klikni pre pridanie)</div>
        <div id="dnes-available-list" class="editor-list"></div>

        <!-- 4) vytvorený zoznam -->
        <div class="editor-subtitle">Vytvorený zoznam (ťahaj pre poradie)</div>
        <div id="dnes-selected-editor" class="editor-list"></div>

        <!-- buttons row (bez ZRUŠIŤ EDITOR) -->
        <div class="btn-row-2">
          <button class="btn-save" onclick="saveDnesEditor()">ULOŽIŤ</button>
          <button class="btn-delete" onclick="clearDnesSelection()">VYMAZAŤ</button>
        </div>
      </div>
    </div>

    <!-- ===== PLAYLISTY ===== -->
    <div class="section-header" onclick="toggleSection('playlists')">
      <h2 class="playlist-header-title">PLAYLISTY</h2>
      <i class="fas fa-chevron-down section-chevron" id="playlists-chevron"></i>
    </div>

    <!-- ✅ OPRAVA: ID musí byť playlists-section-wrapper -->
    <div id="playlists-section-wrapper" class="section-content" style="display:none;">
      <div id="playlists-section" class="list-box">Načítavam...</div>

      <!-- EDITOR PLAYLIST – pod existujúcimi playlistami -->
      <div id="admin-panel" class="editor-panel" style="display:none;">
        <h3 class="editor-title">Editor playlistu</h3>

        <!-- 1) názov playlistu -->
        <input type="text" id="playlist-name" placeholder="Názov playlistu"/>

        <!-- 2) filter -->
        <input type="text" id="playlist-search" placeholder="Vyhľadať pieseň..." autocomplete="off" oninput="filterPlaylistSearch()"/>

        <!-- 3) všetky piesne -->
        <div class="editor-subtitle">Všetky piesne (klikni pre pridanie)</div>
        <div id="playlist-available-list" class="editor-list"></div>

        <!-- 4) vytvorený playlist -->
        <div class="editor-subtitle">Vytvorený playlist (ťahaj pre poradie)</div>
        <div id="selected-list-editor" class="editor-list"></div>

        <!-- buttons row -->
        <div class="btn-row-3">
          <button class="btn-save" onclick="savePlaylist()">ULOŽIŤ</button>
          <button class="btn-cancel" onclick="logoutAdmin()">ZRUŠIŤ EDITOR</button>
          <button class="btn-delete" onclick="clearSelection()">VYMAZAŤ</button>
        </div>
      </div>
    </div>

    <!-- ===== ZOZNAM PIESNÍ ===== -->
    <div class="section-header" onclick="toggleSection('all')">
      <h2 class="playlist-header-title">ZOZNAM PIESNÍ</h2>
      <i class="fas fa-chevron-down section-chevron" id="all-chevron"></i>
    </div>

    <div id="all-section-wrapper" class="section-content" style="display:none;">
      <div id="piesne-list" class="list-box" style="text-align:center; padding:20px; color:#888;">Načítavam...</div>
    </div>

    <!-- ===== AKTUALIZOVAŤ APLIKÁCIU ===== -->
    <div class="section-header" onclick="toggleSection('update')">
      <h2 class="playlist-header-title">AKTUALIZOVAŤ APLIKÁCIU</h2>
      <i class="fas fa-chevron-down section-chevron" id="update-chevron"></i>
    </div>

    <div id="update-section-wrapper" class="section-content" style="display:none;">
      <div class="update-box">
        <button class="btn-update" onclick="hardResetApp()">AKTUALIZOVAŤ APLIKÁCIU</button>
      </div>
    </div>

  </div>

  <!-- SONG DETAIL VIEW -->
  <div id="song-detail" style="display:none;">
    <h2 id="render-title"></h2>
    <button class="back-btn" onclick="closeSong()"><i class="fas fa-arrow-left"></i> Späť na zoznam</button>

    <div class="controls">
      <div class="control-group">
        <small>Pieseň</small>
        <div class="btn-row">
          <button onclick="navigateSong(-1)"><i class="fas fa-chevron-left"></i></button>
          <button onclick="navigateSong(1)"><i class="fas fa-chevron-right"></i></button>
        </div>
      </div>

      <div class="control-group">
        <small>Tónina: <span id="transpose-val">0</span></small>
        <div class="btn-row">
          <button onclick="transposeSong(-1)"><i class="fas fa-minus"></i></button>
          <button onclick="resetTranspose()"><i class="fas fa-undo"></i></button>
          <button onclick="transposeSong(1)"><i class="fas fa-plus"></i></button>
        </div>
        <span id="original-key-label" class="tiny-label">-</span>
      </div>

      <div class="control-group">
        <small>Zobrazenie</small>
        <div class="btn-row">
          <button onclick="toggleChords()"><i class="fas fa-guitar"></i></button>
          <button onclick="changeFontSize(-1)">A-</button>
          <button onclick="changeFontSize(1)">A+</button>
        </div>
      </div>

      <div class="control-group">
        <small>Auto-posun</small>
        <div class="btn-row">
          <button onclick="changeScrollSpeed(-1)"><i class="fas fa-minus"></i></button>
          <button id="scroll-btn" onclick="toggleAutoscroll()"><i class="fas fa-play"></i></button>
          <button onclick="changeScrollSpeed(1)"><i class="fas fa-plus"></i></button>
        </div>
        <span id="speed-label" class="tiny-label">Rýchlosť: 1</span>
      </div>
    </div>

    <div id="song-content"></div>

    <!-- ✅ ERROR REPORT (Formspree) -->
    <div id="error-report-container">
      <p class="error-title">Našiel/la si chybu? Napíš, opravím :)</p>

      <form id="error-form" onsubmit="submitErrorForm(event)">
        <input type="text" name="meno" placeholder="Tvoje meno" required>
        <textarea name="chyba" placeholder="Napr. chybný akord, preklep v texte..." required></textarea>

        <!-- doplníme aj song info -->
        <input type="hidden" name="piesen" id="error-song-hidden" value="">

        <button type="submit" id="submit-btn">ODOSLAŤ</button>
      </form>

      <p id="form-status" style="display:none;">Chyba bola odoslaná!</p>
    </div>
  </div>

</div>

<script src="script.js?v=5"></script>
</body>
</html>
